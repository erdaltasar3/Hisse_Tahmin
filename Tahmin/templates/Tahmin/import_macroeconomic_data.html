{% extends 'Tahmin/admin_base.html' %}

{% block content %}
<!-- SweetAlert2 kütüphanesini ekleyin -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<div class="bg-white rounded-lg shadow-lg p-6">
    <h1 class="text-2xl font-bold mb-6 text-gray-800">Makroekonomik Veri Yükleme</h1>
    
    <div class="bg-indigo-50 p-5 rounded-lg border border-indigo-200 mb-6">
        <div class="flex items-start">
            <div class="flex-shrink-0 mt-1">
                <svg class="h-6 w-6 text-indigo-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
            </div>
            <div class="ml-3">
                <h3 class="text-lg font-medium text-indigo-800">Makroekonomik Veri Yükleme</h3>
                <div class="mt-2 text-indigo-700">
                    <p>Bu sayfadan farklı makroekonomik verileri ayrı ayrı yükleyebilirsiniz. İlgili veri türünü seçerek veri girişi yapabilirsiniz.</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Sekmeli Arayüz için Tab Başlıkları -->
    <div class="border-b border-gray-200 mb-6">
        <ul class="flex flex-wrap -mb-px" id="macroTabs" role="tablist">
            <li class="mr-2" role="presentation">
                <button class="inline-block py-3 px-4 text-sm font-medium text-center text-gray-500 border-b-2 border-transparent rounded-t-lg hover:text-gray-600 hover:border-gray-300" 
                        id="inflation-tab" 
                        data-tabs-target="#inflation" 
                        type="button" 
                        role="tab" 
                        aria-controls="inflation" 
                        aria-selected="false">
                    Enflasyon Oranları
                </button>
            </li>
            <li class="mr-2" role="presentation">
                <button class="inline-block py-3 px-4 text-sm font-medium text-center text-gray-500 border-b-2 border-transparent rounded-t-lg hover:text-gray-600 hover:border-gray-300" 
                        id="interest-tab" 
                        data-tabs-target="#interest" 
                        type="button" 
                        role="tab" 
                        aria-controls="interest" 
                        aria-selected="false">
                    Faiz Oranları
                </button>
            </li>
            <li class="mr-2" role="presentation">
                <button class="inline-block py-3 px-4 text-sm font-medium text-center text-indigo-600 border-b-2 border-indigo-600 rounded-t-lg active" 
                        id="exchange-tab" 
                        data-tabs-target="#exchange" 
                        type="button" 
                        role="tab" 
                        aria-controls="exchange" 
                        aria-selected="true">
                    Döviz Kurları
                </button>
            </li>
            <li class="mr-2" role="presentation">
                <button class="inline-block py-3 px-4 text-sm font-medium text-center text-gray-500 border-b-2 border-transparent rounded-t-lg hover:text-gray-600 hover:border-gray-300" 
                        id="gdp-tab" 
                        data-tabs-target="#gdp" 
                        type="button" 
                        role="tab" 
                        aria-controls="gdp" 
                        aria-selected="false">
                    GSYH Büyüme
                </button>
            </li>
        </ul>
    </div>

    <!-- Tab İçerikleri -->
    <div id="tabContent">
        <!-- Enflasyon Oranları Sekmesi -->
        <div class="hidden p-4 bg-white rounded-lg" id="inflation" role="tabpanel" aria-labelledby="inflation-tab">
            <div class="bg-yellow-50 p-4 rounded-lg border border-yellow-200 mb-6">
                <div class="flex items-start">
                    <div class="flex-shrink-0">
                        <svg class="h-5 w-5 text-yellow-600" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2h-1V9z" clip-rule="evenodd"></path>
                        </svg>
                    </div>
                    <div class="ml-3">
                        <h3 class="text-sm font-medium text-yellow-800">Enflasyon Verileri (TÜFE/ÜFE) Yükleme</h3>
                        <div class="mt-2 text-sm text-yellow-700">
                            <p>OCR yöntemiyle TÜİK raporlarından enflasyon verilerini çıkarabilir veya Excel dosyası yükleyebilirsiniz.</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Enflasyon Verileri Giriş Formu -->
            <div class="bg-white p-4 rounded-lg border border-gray-200 mb-6">
                <h3 class="text-lg font-medium text-gray-900 mb-4">Enflasyon Verileri Girişi</h3>
                
                <form action="{% url 'import_macroeconomic_data' %}" method="post" enctype="multipart/form-data" class="space-y-4">
                    {% csrf_token %}
                    <input type="hidden" name="data_type" value="inflation">
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-4">
                        <div>
                            <label for="inflation_year" class="block text-sm font-medium text-gray-700 mb-1">Yıl</label>
                            <select id="inflation_year" name="inflation_year" class="mt-1 block w-full py-2 px-3 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                                <option value="2025">2025</option>
                                <option value="2024">2024</option>
                                <option value="2023">2023</option>
                                <option value="2022">2022</option>
                                <option value="2021">2021</option>
                                <option value="2020">2020</option>
                            </select>
                        </div>
                        
                        <div>
                            <label for="inflation_source" class="block text-sm font-medium text-gray-700 mb-1">Veri Kaynağı</label>
                            <input type="text" id="inflation_source" name="inflation_source" class="mt-1 block w-full py-2 px-3 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm" value="TÜİK">
                        </div>
                    </div>
                    
                    <div class="bg-gray-50 p-4 rounded-lg border border-gray-200">
                        <h4 class="text-md font-medium text-gray-800 mb-2">Aylık Enflasyon Verileri</h4>
                        
                        <div id="inflation-data">
                            <div class="overflow-x-auto">
                                <table class="min-w-full divide-y divide-gray-200">
                                    <thead>
                                        <tr>
                                            <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Ay</th>
                                            <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">TÜFE Aylık (%)</th>
                                            <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">TÜFE Yıllık (%)</th>
                                            <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ÜFE Aylık (%)</th>
                                            <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ÜFE Yıllık (%)</th>
                                        </tr>
                                    </thead>
                                    <tbody id="inflation-data-body" class="bg-white divide-y divide-gray-200">
                                        <!-- JavaScript ile doldurulacak -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    
                    <div class="flex justify-end space-x-3 mt-4">
                        <input type="hidden" id="inflation_data" name="inflation_data" value="">
                        <button type="submit" class="inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-yellow-600 hover:bg-yellow-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-yellow-500">
                            <svg class="w-5 h-5 mr-2 -ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                            </svg>
                            Enflasyon Verilerini Kaydet
                        </button>
                    </div>
                </form>
            </div>
            
            <!-- Excel ile Veri Yükleme -->
            <div class="bg-white p-4 rounded-lg border border-gray-200 mb-6">
                <h3 class="text-lg font-medium text-gray-900 mb-4">Excel Dosyası ile Yükleme</h3>
                
                <form action="{% url 'import_macroeconomic_data' %}" method="post" enctype="multipart/form-data" class="space-y-4">
                    {% csrf_token %}
                    <input type="hidden" name="data_type" value="inflation_excel">
                    
                    <div class="flex flex-col space-y-2">
                        <label for="inflation_file" class="block text-sm font-medium text-gray-700">Enflasyon Verisi Excel Dosyası</label>
                        <div class="flex items-center justify-center w-full">
                            <label class="flex flex-col rounded-lg border-2 border-dashed border-gray-300 w-full h-32 p-4 group hover:bg-gray-50 cursor-pointer">
                                <div class="h-full w-full text-center flex flex-col items-center justify-center">
                                    <svg class="w-10 h-10 text-gray-400 group-hover:text-yellow-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 13h6m-3-3v6m5 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                                    </svg>
                                    <p class="text-gray-500 text-sm mt-2 pointer-events-none">Enflasyon verilerini yükleyin</p>
                                    <p class="text-xs text-gray-400 mt-1 pointer-events-none">Excel formatı (.xlsx, .xls)</p>
                                    <input type="file" name="inflation_file" id="inflation_file" accept=".xlsx, .xls" class="hidden" required />
                                </div>
                            </label>
                        </div>
                        <div id="inflation-file-name" class="text-sm text-yellow-600 font-medium ml-1 mt-1 hidden"></div>
                    </div>
                    
                    <button type="submit" class="inline-flex justify-center py-2 px-6 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-yellow-600 hover:bg-yellow-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-yellow-500">
                        <svg class="w-5 h-5 mr-2 -ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0l-4 4m4-4v12"></path>
                        </svg>
                        Excel Dosyasını Yükle
                    </button>
                </form>
            </div>
        </div>

        <!-- Faiz Oranları Sekmesi -->
        <div class="hidden p-4 bg-white rounded-lg" id="interest" role="tabpanel" aria-labelledby="interest-tab">
            <div class="bg-blue-50 p-4 rounded-lg border border-blue-200 mb-6">
                <div class="flex items-start">
                    <div class="flex-shrink-0">
                        <svg class="h-5 w-5 text-blue-600" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2h-1V9z" clip-rule="evenodd"></path>
                        </svg>
                    </div>
                    <div class="ml-3">
                        <h3 class="text-sm font-medium text-blue-800">Faiz Oranları Yükleme</h3>
                        <div class="mt-2 text-sm text-blue-700">
                            <p>Politika faizi ve tahvil faizi (2Y/10Y) verilerini seçtiğiniz yöntemle yükleyebilirsiniz.</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Yükleme Yöntemi Seçimi -->
            <div class="bg-white mb-6">
                <div class="border-b border-gray-200">
                    <nav class="-mb-px flex space-x-6" aria-label="Tabs">
                        <button id="combined-upload-tab" class="border-blue-500 text-blue-600 whitespace-nowrap py-3 px-4 border-b-2 font-medium text-sm cursor-pointer" aria-current="page" data-target="combined-upload">Tek Dosya Yükleme</button>
                        <button id="separate-upload-tab" class="border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 whitespace-nowrap py-3 px-4 border-b-2 font-medium text-sm cursor-pointer" data-target="separate-upload">Ayrı Dosyalar Yükleme</button>
                    </nav>
                </div>
            </div>
            
            <!-- Tek Dosya Yükleme -->
            <div id="combined-upload" class="bg-white p-4 rounded-lg border border-gray-200 mb-6">
                <h3 class="text-lg font-medium text-gray-900 mb-4">Birleşik Faiz Oranları Dosyası</h3>
                
                <form action="{% url 'import_macroeconomic_data' %}" method="post" enctype="multipart/form-data" class="space-y-4">
                    {% csrf_token %}
                    <input type="hidden" name="data_type" value="interest">
                    <input type="hidden" name="upload_method" value="combined">
                    
                    <div class="flex flex-col space-y-2">
                        <label for="interest_file" class="block text-sm font-medium text-gray-700">Faiz Oranları Excel Dosyası</label>
                        <div class="flex items-center justify-center w-full">
                            <label class="flex flex-col rounded-lg border-2 border-dashed border-gray-300 w-full h-32 p-4 group hover:bg-gray-50 cursor-pointer">
                                <div class="h-full w-full text-center flex flex-col items-center justify-center">
                                    <svg class="w-10 h-10 text-gray-400 group-hover:text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 13h6m-3-3v6m5 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                                    </svg>
                                    <p class="text-gray-500 text-sm mt-2 pointer-events-none">Faiz oranları dosyasını yükleyin</p>
                                    <p class="text-xs text-gray-400 mt-1 pointer-events-none">Excel formatı (.xlsx, .xls)</p>
                                    <input type="file" name="interest_file" id="interest_file" accept=".xlsx, .xls" class="hidden" required />
                                </div>
                            </label>
                        </div>
                        <div id="interest-file-name" class="text-sm text-blue-600 font-medium ml-1 mt-1 hidden"></div>
                    </div>
                    
                    <button type="submit" class="inline-flex justify-center py-2 px-6 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                        <svg class="w-5 h-5 mr-2 -ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0l-4 4m4-4v12"></path>
                        </svg>
                        Faiz Verilerini Yükle
                    </button>
                </form>
            </div>
            
            <!-- Ayrı Dosyalar Yükleme -->
            <div id="separate-upload" class="hidden bg-white p-4 rounded-lg border border-gray-200 mb-6">
                <h3 class="text-lg font-medium text-gray-900 mb-4">Politika Faizi ve Tahvil Faizi Verileri</h3>
                
                <form action="{% url 'import_macroeconomic_data' %}" method="post" enctype="multipart/form-data" class="space-y-6">
                    {% csrf_token %}
                    <input type="hidden" name="data_type" value="interest">
                    <input type="hidden" name="upload_method" value="separate">
                    
                    <!-- Politika Faizi -->
                    <div class="border-t border-gray-200 pt-4">
                        <h4 class="text-md font-medium text-gray-700 mb-3">Politika Faizi (TCMB)</h4>
                        
                        <div id="policy-rate-upload" class="mb-4">
                            <div class="flex flex-col space-y-2">
                                <label for="policy_rate_file" class="block text-sm font-medium text-gray-700">Politika Faizi Excel/CSV Dosyası</label>
                                <div class="flex items-center justify-center w-full">
                                    <label class="flex flex-col rounded-lg border-2 border-dashed border-gray-300 w-full h-24 p-2 group hover:bg-gray-50 cursor-pointer">
                                        <div class="h-full w-full text-center flex flex-col items-center justify-center">
                                            <svg class="w-8 h-8 text-gray-400 group-hover:text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 13h6m-3-3v6m5 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                                            </svg>
                                            <p class="text-gray-500 text-sm mt-1 pointer-events-none">Politika faizi verilerini yükleyin</p>
                                            <input type="file" name="policy_rate_file" id="policy_rate_file" accept=".csv, .xlsx, .xls" class="hidden" />
                                        </div>
                                    </label>
                                </div>
                                <div id="policy-rate-file-name" class="text-sm text-blue-600 font-medium ml-1 mt-1 hidden"></div>
                            </div>
                        </div>
                        
                        <input type="hidden" name="policy_rate_data" id="policy_rate_data" value="">
                    </div>
                    
                    <!-- Tahvil Faizi -->
                    <div class="border-t border-gray-200 pt-4">
                        <h4 class="text-md font-medium text-gray-700 mb-3">Tahvil Faizleri (2Y/10Y)</h4>
                        
                        <div class="flex flex-col space-y-2">
                            <label for="bond_yield_file" class="block text-sm font-medium text-gray-700">Tahvil Faizi Excel/CSV Dosyası</label>
                            <div class="flex items-center justify-center w-full">
                                <label class="flex flex-col rounded-lg border-2 border-dashed border-gray-300 w-full h-24 p-2 group hover:bg-gray-50 cursor-pointer">
                                    <div class="h-full w-full text-center flex flex-col items-center justify-center">
                                        <svg class="w-8 h-8 text-gray-400 group-hover:text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 13h6m-3-3v6m5 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                                        </svg>
                                        <p class="text-gray-500 text-sm mt-1 pointer-events-none">Tahvil faizi verilerini yükleyin</p>
                                        <input type="file" name="bond_yield_file" id="bond_yield_file" accept=".csv, .xlsx, .xls" class="hidden" />
                                    </div>
                                </label>
                            </div>
                            <div id="bond-yield-file-name" class="text-sm text-blue-600 font-medium ml-1 mt-1 hidden"></div>
                        </div>
                    </div>
                    
                    <div class="flex justify-end space-x-3 pt-4 border-t border-gray-200">
                        <button type="submit" class="inline-flex justify-center py-2 px-6 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                            <svg class="w-5 h-5 mr-2 -ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0l-4 4m4-4v12"></path>
                            </svg>
                            Faiz Verilerini Birleştir ve Yükle
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Döviz Kurları Sekmesi -->
        <div class="block p-4 bg-white rounded-lg" id="exchange" role="tabpanel" aria-labelledby="exchange-tab">
            <div class="bg-green-50 p-4 rounded-lg border border-green-200 mb-6">
                <div class="flex items-start">
                    <div class="flex-shrink-0">
                        <svg class="h-5 w-5 text-green-600" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2h-1V9z" clip-rule="evenodd"></path>
                        </svg>
                    </div>
                    <div class="ml-3">
                        <h3 class="text-sm font-medium text-green-800">Döviz Kuru Verileri Yükleme</h3>
                        <div class="mt-2 text-sm text-green-700">
                            <p>USD/TL ve EUR/TL verilerini ayrı ayrı yükleyebilirsiniz. Sistem, tarih bazında eşleştirme yapacaktır.</p>
                            <p class="mt-1">CSV dosyalarınızda şu sütunlar bulunmalıdır: <code class="px-2 py-1 bg-green-100 rounded">tarih</code>, <code class="px-2 py-1 bg-green-100 rounded">açılış</code>, <code class="px-2 py-1 bg-green-100 rounded">yüksek</code>, <code class="px-2 py-1 bg-green-100 rounded">düşük</code>, <code class="px-2 py-1 bg-green-100 rounded">kapanış/şimdi</code></p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- USD/TL Kısmı -->
            <div class="mb-8 bg-white p-4 rounded-lg border border-gray-200">
                <h3 class="text-lg font-medium text-gray-900 mb-4">USD/TL Verileri</h3>
                
                <form action="{% url 'import_macroeconomic_data' %}" method="post" enctype="multipart/form-data" class="space-y-4">
                    {% csrf_token %}
                    <input type="hidden" name="data_type" value="exchange">
                    <input type="hidden" name="upload_method" value="separate">
                    <input type="hidden" name="currency_type" value="USD">
                    
                    <div class="flex flex-col space-y-2">
                        <label for="usd_file" class="block text-sm font-medium text-gray-700">USD/TL Verisi CSV Dosyası</label>
                        <div class="flex items-center justify-center w-full">
                            <label class="flex flex-col rounded-lg border-2 border-dashed border-gray-300 w-full h-32 p-4 group hover:bg-gray-50 cursor-pointer">
                                <div class="h-full w-full text-center flex flex-col items-center justify-center">
                                    <svg class="w-10 h-10 text-gray-400 group-hover:text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 13h6m-3-3v6m5 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                                    </svg>
                                    <p class="text-gray-500 text-sm mt-2 pointer-events-none">Dolar/TL verilerini yükleyin</p>
                                    <p class="text-xs text-gray-400 mt-1 pointer-events-none">CSV veya Excel formatı</p>
                                    <input type="file" name="exchange_file" id="usd_file" accept=".csv, .xlsx, .xls" class="hidden" required />
                                </div>
                            </label>
                        </div>
                        <div id="usd-file-name" class="text-sm text-green-600 font-medium ml-1 mt-1 hidden"></div>
                    </div>

                    <button type="submit" class="inline-flex justify-center py-2 px-6 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500">
                        <svg class="w-5 h-5 mr-2 -ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0l-4 4m4-4v12"></path>
                        </svg>
                        USD/TL Verilerini Yükle
                    </button>
                </form>
            </div>

            <!-- EUR/TL Kısmı -->
            <div class="mb-8 bg-white p-4 rounded-lg border border-gray-200">
                <h3 class="text-lg font-medium text-gray-900 mb-4">EUR/TL Verileri</h3>
                
                <form action="{% url 'import_macroeconomic_data' %}" method="post" enctype="multipart/form-data" class="space-y-4">
                    {% csrf_token %}
                    <input type="hidden" name="data_type" value="exchange">
                    <input type="hidden" name="upload_method" value="separate">
                    <input type="hidden" name="currency_type" value="EUR">
                    
                    <div class="flex flex-col space-y-2">
                        <label for="eur_file" class="block text-sm font-medium text-gray-700">EUR/TL Verisi CSV Dosyası</label>
                        <div class="flex items-center justify-center w-full">
                            <label class="flex flex-col rounded-lg border-2 border-dashed border-gray-300 w-full h-32 p-4 group hover:bg-gray-50 cursor-pointer">
                                <div class="h-full w-full text-center flex flex-col items-center justify-center">
                                    <svg class="w-10 h-10 text-gray-400 group-hover:text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 13h6m-3-3v6m5 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                                    </svg>
                                    <p class="text-gray-500 text-sm mt-2 pointer-events-none">Euro/TL verilerini yükleyin</p>
                                    <p class="text-xs text-gray-400 mt-1 pointer-events-none">CSV veya Excel formatı</p>
                                    <input type="file" name="exchange_file" id="eur_file" accept=".csv, .xlsx, .xls" class="hidden" required />
                                </div>
                            </label>
                        </div>
                        <div id="eur-file-name" class="text-sm text-green-600 font-medium ml-1 mt-1 hidden"></div>
                    </div>

                    <button type="submit" class="inline-flex justify-center py-2 px-6 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500">
                        <svg class="w-5 h-5 mr-2 -ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0l-4 4m4-4v12"></path>
                        </svg>
                        EUR/TL Verilerini Yükle
                    </button>
                </form>
            </div>

            <!-- Örnek CSV Formatı -->
            <div class="mt-6 bg-gray-50 p-5 rounded-lg border border-gray-200">
                <h3 class="text-md font-medium text-gray-900 mb-3">Örnek Döviz Kuru Formatı</h3>
                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-100">
                            <tr>
                                <th scope="col" class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Tarih</th>
                                <th scope="col" class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Şimdi</th>
                                <th scope="col" class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Açılış</th>
                                <th scope="col" class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Yüksek</th>
                                <th scope="col" class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Düşük</th>
                                <th scope="col" class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Hacim</th>
                                <th scope="col" class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Fark %</th>
                            </tr>
                        </thead>
                        <tbody class="bg-white divide-y divide-gray-200">
                            <tr>
                                <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-500">15.05.2025</td>
                                <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-500">38.6914</td>
                                <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-500">38.7287</td>
                                <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-500">38.7901</td>
                                <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-500">38.6595</td>
                                <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-500">-</td>
                                <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-500">-0.19%</td>
                            </tr>
                            <tr>
                                <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-500">14.05.2025</td>
                                <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-500">38.7644</td>
                                <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-500">38.7287</td>
                                <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-500">38.8993</td>
                                <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-500">38.6162</td>
                                <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-500">-</td>
                                <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-500">-0.07%</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- GSYH Büyüme Sekmesi -->
        <div class="hidden p-4 bg-white rounded-lg" id="gdp" role="tabpanel" aria-labelledby="gdp-tab">
            <div class="bg-purple-50 p-4 rounded-lg border border-purple-200 mb-6">
                <p class="text-sm text-purple-700">GSYH büyüme verilerini Excel dosyası olarak yükleyebilirsiniz.</p>
            </div>
            <!-- GSYH büyüme verisi yükleme formları buraya gelecek -->
        </div>
    </div>

    <div class="flex justify-start items-center pt-8">
        <a href="{% url 'prediction_data_sources' %}" class="inline-flex justify-center py-2 px-4 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
            <svg class="w-5 h-5 mr-2 -ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
            </svg>
            Veri Kaynaklarına Dön
        </a>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Dosya Yükleme İşlemleri
    const usdFileInput = document.getElementById('usd_file');
    const usdFileName = document.getElementById('usd-file-name');
    const eurFileInput = document.getElementById('eur_file');
    const eurFileName = document.getElementById('eur-file-name');
    
    // USD dosya seçildiğinde
    if (usdFileInput) {
        usdFileInput.addEventListener('change', function() {
            if (this.files.length > 0) {
                usdFileName.textContent = 'Seçilen dosya: ' + this.files[0].name;
                usdFileName.classList.remove('hidden');
            } else {
                usdFileName.textContent = '';
                usdFileName.classList.add('hidden');
            }
        });
    }
    
    // EUR dosya seçildiğinde
    if (eurFileInput) {
        eurFileInput.addEventListener('change', function() {
            if (this.files.length > 0) {
                eurFileName.textContent = 'Seçilen dosya: ' + this.files[0].name;
                eurFileName.classList.remove('hidden');
            } else {
                eurFileName.textContent = '';
                eurFileName.classList.add('hidden');
            }
        });
    }
    
    // Form gönderimlerini yakala ve SweetAlert2 ile sonuç göster
    const exchangeForms = document.querySelectorAll('form[action="{% url "import_macroeconomic_data" %}"]');
    
    exchangeForms.forEach(form => {
        form.addEventListener('submit', function(e) {
            e.preventDefault();
            
            // Yükleme işlemi başlamadan önce loading göster
            Swal.fire({
                title: 'İşleniyor...',
                html: 'Dosya yükleniyor ve işleniyor, lütfen bekleyin.',
                allowOutsideClick: false,
                didOpen: () => {
                    Swal.showLoading();
                }
            });
            
            // Form verilerini al
            const formData = new FormData(this);
            
            // AJAX ile formu gönder
            fetch('{% url "import_macroeconomic_data" %}', {
                method: 'POST',
                body: formData,
                headers: {
                    'X-Requested-With': 'XMLHttpRequest'
                }
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Sunucu hatası oluştu.');
                }
                return response.text();
            })
            .then(html => {
                // Başarılı işlem mesajı göster (içerik kontrolü yapmadan)
                Swal.fire({
                    title: 'İşlem Başarılı!',
                    text: 'Dosya başarıyla yüklendi ve işlendi.',
                    icon: 'success',
                    confirmButtonText: 'Tamam'
                }).then((result) => {
                    // Popup kapatıldıktan sonra sayfayı yenileyelim
                    if (result.isConfirmed) {
                        window.location.reload();
                    }
                });
            })
            .catch(error => {
                // Hata durumunda
                Swal.fire({
                    title: 'Hata!',
                    text: error.message || 'Bir hata oluştu.',
                    icon: 'error',
                    confirmButtonText: 'Tamam'
                });
            });
        });
    });
    
    // Tab Geçişleri
    const tabButtons = document.querySelectorAll('#macroTabs button[role="tab"]');
    const tabContents = document.querySelectorAll('#tabContent > div[role="tabpanel"]');
    
    tabButtons.forEach(button => {
        button.addEventListener('click', function() {
            // Aktif tab butonunun stilini kaldır
            tabButtons.forEach(btn => {
                btn.classList.remove('text-indigo-600', 'border-indigo-600');
                btn.classList.add('text-gray-500', 'border-transparent');
                btn.setAttribute('aria-selected', 'false');
            });
            
            // Tıklanan butonun stilini güncelle
            this.classList.remove('text-gray-500', 'border-transparent');
            this.classList.add('text-indigo-600', 'border-indigo-600');
            this.setAttribute('aria-selected', 'true');
            
            // Tab içeriklerini gizle
            tabContents.forEach(content => {
                content.classList.add('hidden');
                content.classList.remove('block');
            });
            
            // Seçilen tab içeriğini göster
            const targetTab = this.getAttribute('data-tabs-target').substring(1);
            document.getElementById(targetTab).classList.remove('hidden');
            document.getElementById(targetTab).classList.add('block');
        });
    });
    
    // Faiz Oranları Alt Sekmeleri
    const interestSubTabButtons = document.querySelectorAll('#combined-upload-tab, #separate-upload-tab');
    const interestSubTabContents = document.querySelectorAll('#combined-upload, #separate-upload');
    
    interestSubTabButtons.forEach(button => {
        button.addEventListener('click', function() {
            // Aktif alt tab butonunun stilini kaldır
            interestSubTabButtons.forEach(btn => {
                btn.classList.remove('border-blue-500', 'text-blue-600');
                btn.classList.add('border-transparent', 'text-gray-500');
            });
            
            // Tıklanan butonun stilini güncelle
            this.classList.remove('border-transparent', 'text-gray-500');
            this.classList.add('border-blue-500', 'text-blue-600');
            
            // Alt tab içeriklerini gizle
            interestSubTabContents.forEach(content => {
                content.classList.add('hidden');
            });
            
            // Seçilen alt tab içeriğini göster
            const targetContent = this.getAttribute('data-target');
            document.getElementById(targetContent).classList.remove('hidden');
        });
    });
    
    // Enflasyon verileri için tablo oluşturma
    const inflationDataBody = document.getElementById('inflation-data-body');
    const inflationYear = document.getElementById('inflation_year');
    const inflationDataJson = document.getElementById('inflation_data');
    
    if (inflationYear && inflationDataBody) {
        // Yıl değiştiğinde tabloyu güncelle
        inflationYear.addEventListener('change', function() {
            generateInflationTable();
        });
        
        // Sayfa yüklendiğinde tabloyu oluştur
        generateInflationTable();
        
        function generateInflationTable() {
            const months = ['Ocak', 'Şubat', 'Mart', 'Nisan', 'Mayıs', 'Haziran', 'Temmuz', 'Ağustos', 'Eylül', 'Ekim', 'Kasım', 'Aralık'];
            let tableHtml = '';
            
            months.forEach(month => {
                tableHtml += `
                <tr>
                    <td class="px-3 py-2 whitespace-nowrap">${month}</td>
                    <td class="px-3 py-2">
                        <input type="number" step="0.01" data-field="tufe_monthly" data-month="${month}" 
                            class="w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                    </td>
                    <td class="px-3 py-2">
                        <input type="number" step="0.01" data-field="tufe_yearly" data-month="${month}" 
                            class="w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                    </td>
                    <td class="px-3 py-2">
                        <input type="number" step="0.01" data-field="ufe_monthly" data-month="${month}" 
                            class="w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                    </td>
                    <td class="px-3 py-2">
                        <input type="number" step="0.01" data-field="ufe_yearly" data-month="${month}" 
                            class="w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                    </td>
                </tr>
                `;
            });
            
            inflationDataBody.innerHTML = tableHtml;
            
            // Input değişikliklerini dinle
            const inputs = inflationDataBody.querySelectorAll('input');
            inputs.forEach(input => {
                input.addEventListener('input', function() {
                    updateInflationJsonData();
                });
            });
            
            // JSON veriyi güncelle
            updateInflationJsonData();
        }
        
        function updateInflationJsonData() {
            const year = inflationYear.value;
            const data = [];
            
            // Tablodan değerleri al
            const rows = inflationDataBody.querySelectorAll('tr');
            rows.forEach(row => {
                const month = row.querySelector('td:first-child').textContent;
                const tufe_monthly = parseFloat(row.querySelector('input[data-field="tufe_monthly"]').value) || 0;
                const tufe_yearly = parseFloat(row.querySelector('input[data-field="tufe_yearly"]').value) || 0;
                const ufe_monthly = parseFloat(row.querySelector('input[data-field="ufe_monthly"]').value) || 0;
                const ufe_yearly = parseFloat(row.querySelector('input[data-field="ufe_yearly"]').value) || 0;
                
                data.push({
                    month: month,
                    year: parseInt(year),
                    tufe_monthly: tufe_monthly,
                    tufe_yearly: tufe_yearly,
                    ufe_monthly: ufe_monthly,
                    ufe_yearly: ufe_yearly
                });
            });
            
            // JSON olarak hidden input'a yerleştir
            inflationDataJson.value = JSON.stringify(data);
        }
    }
    
    // Dosya isimlerini gösterme
    const inflationFileInput = document.getElementById('inflation_file');
    const inflationFileName = document.getElementById('inflation-file-name');
    
    const interestFileInput = document.getElementById('interest_file');
    const interestFileName = document.getElementById('interest-file-name');
    
    const policyRateFileInput = document.getElementById('policy_rate_file');
    const policyRateFileName = document.getElementById('policy-rate-file-name');
    
    const bondYieldFileInput = document.getElementById('bond_yield_file');
    const bondYieldFileName = document.getElementById('bond-yield-file-name');
    
    // Inflation file
    if (inflationFileInput && inflationFileName) {
        inflationFileInput.addEventListener('change', function() {
            if (this.files.length > 0) {
                inflationFileName.textContent = 'Seçilen dosya: ' + this.files[0].name;
                inflationFileName.classList.remove('hidden');
            } else {
                inflationFileName.textContent = '';
                inflationFileName.classList.add('hidden');
            }
        });
    }
    
    // Interest combined file
    if (interestFileInput && interestFileName) {
        interestFileInput.addEventListener('change', function() {
            if (this.files.length > 0) {
                interestFileName.textContent = 'Seçilen dosya: ' + this.files[0].name;
                interestFileName.classList.remove('hidden');
            } else {
                interestFileName.textContent = '';
                interestFileName.classList.add('hidden');
            }
        });
    }
    
    // Policy rate file
    if (policyRateFileInput && policyRateFileName) {
        policyRateFileInput.addEventListener('change', function() {
            if (this.files.length > 0) {
                policyRateFileName.textContent = 'Seçilen dosya: ' + this.files[0].name;
                policyRateFileName.classList.remove('hidden');
            } else {
                policyRateFileName.textContent = '';
                policyRateFileName.classList.add('hidden');
            }
        });
    }
    
    // Bond yield file
    if (bondYieldFileInput && bondYieldFileName) {
        bondYieldFileInput.addEventListener('change', function() {
            if (this.files.length > 0) {
                bondYieldFileName.textContent = 'Seçilen dosya: ' + this.files[0].name;
                bondYieldFileName.classList.remove('hidden');
            } else {
                bondYieldFileName.textContent = '';
                bondYieldFileName.classList.add('hidden');
            }
        });
    }
});
</script>
{% endblock %} 